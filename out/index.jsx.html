<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { useState } from 'react';
import { BiUser } from 'react-icons/bi';
import useAuth from '../../hooks/useAuth';
import { Button } from '../Button';
import { ReportStyles } from './styles';
import firebase from '../../lib/firebase';
import { useRouter } from 'next/router';
import { sendEmail } from '../../utils/utils';

/**
 * componente responsavel por modularizar nossa formulario de criacao de ocorrencia
 * @param {*} props propiedades herdadas da pagina
 * @returns retorna um componente pronto para uso com html css e js
 */
export function FormReport(props) {
  //variaveis
  const [reportTitle, setReportTitle] = useState();
  const [reportText, setReportText] = useState();
  const { user } = useAuth();
  const router = useRouter();
  const { uid } = router.query;
  // console.log('usuario pagina de from',user, uid)
  // console.log(props.avatar)

  /**
   * funcao responsavel por cadastrar requisicao no banco de dados
   * @param {*} event captura os eventos que acontecem na pagina
   * @returns retorna os estado resultante das interações (SUCCESS, FAILED)
   */
  async function handleSendNewReport(event) {
    //gerando o timestamp da data atual
    let currentData = new Date().getTime() / 1000;
    event.preventDefault();

    if (reportText.trim() === '') {
      alert('Descrição Não pode ser vazia');
      return;
    }
    if (reportTitle.trim() === '') {
      alert('Titulo Não pode ser vazio');
      return;
    }
    const report = {
      title: reportTitle,
      content: reportText,
      author: {
        name: user.name,
        email: user.email,
      },
      isSolved: false,
      //data é armazenada em timestamp
      registerDate: currentData.toString(),
      underInvestigation: false,
    };
    await firebase.database().ref(`rooms/${uid}/reports`).push(report);

    setReportText('');
    setReportTitle('');

    let template_params = {
      from_name: 'contato.bugreports@gmail.com:',
      message:
        'Sua ocorrência foi cadastrada com Sucesso, fique ligado no seu email para novas atualizações 🧑🏼‍💻🧑🏻‍💻👩🏻‍💻',
      to_name: user.email,
    };

    //chamando a funcao de envio de email
    sendEmail(template_params);
  }

  return (
    &lt;ReportStyles>
      &lt;div className="container">
        &lt;div className="roomTitle">
          &lt;h1>{props.roomTitle}&lt;/h1>
          &lt;span>({props.qtdPerguntas}) Ocorrência(s)&lt;/span>
        &lt;/div>
        &lt;form onSubmit={handleSendNewReport} id="form">
          &lt;input
            type="text"
            required
            placeholder="Titulo da Ocorrência"
            className="tituloOcorrencia"
            onChange={(event) => {
              setReportTitle(event.target.value);
            }}
            value={reportTitle}
            data-testid="title"
          />
          &lt;textarea
            required
            name="Descrição da ocorrência"
            placeholder="Descreva sua Ocorrência"
            onChange={(event) => {
              setReportText(event.target.value);
            }}
            value={reportText}
            data-testid="description"
          />
          &lt;div className="formFooter">
            {/* &lt;Button className="btnVideo">Anexar seu Vídeo&lt;/Button> */}
            &lt;div className="userInfo">
              &lt;div className="containerIcone">
                {props.avatar ? (
                  &lt;img src={props.avatar} alt="icone autor" className="icon" />
                ) : (
                  &lt;BiUser className="icon" />
                )}
              &lt;/div>
              &lt;span>{props.name}&lt;/span>
            &lt;/div>
            &lt;div className="btnSend">
              &lt;Button type="submit"  data-testid="add-report-button">Enviar Ocorrência&lt;/Button>
            &lt;/div>
          &lt;/div>
        &lt;/form>
      &lt;/div>
    &lt;/ReportStyles>
  );
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#FormReport">FormReport</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Wed Aug 25 2021 09:30:25 GMT-0300 (Brasilia Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
